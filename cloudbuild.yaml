steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build',
         '--target',
         'zebra-tests',
         '-t',
         'gcr.io/$PROJECT_ID/zcashfoundation/zebra/tests/$BRANCH_NAME:$SHORT_SHA',
         '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['build',
         '--build-arg',
         'checkpoint_sync=${_CHECKPOINT_SYNC}',
         '--build-arg',
         'network=${_NETWORK}',
         '--target',
         'zebrad-release',
         '-t',
         'gcr.io/$PROJECT_ID/zcashfoundation/zebra/$BRANCH_NAME:$SHORT_SHA',
         '.']

images:
- 'gcr.io/$PROJECT_ID/zcashfoundation/zebra/tests/$BRANCH_NAME:$SHORT_SHA'
- 'gcr.io/$PROJECT_ID/zcashfoundation/zebra/$BRANCH_NAME:$SHORT_SHA'

options:
    machineType: 'N1_HIGHCPU_32'
    substitution_option: 'ALLOW_LOOSE'

timeout: 1800s # 30 mins
